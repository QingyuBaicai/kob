(function(){"use strict";var e={906:function(e,t,s){var a=s(9242),o=s(3396);function n(e,t,s,a,n,r){const l=(0,o.up)("NavBar"),i=(0,o.up)("router-view");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(l),(0,o.Wm)(i)],64)}var r=s(7139);const l={class:"navbar navbar-expand-lg navbar-dark bg-dark"},i={class:"container"},c=(0,o.Uk)("King Of Bots"),d={class:"collapse navbar-collapse",id:"navbarText"},u={class:"navbar-nav me-auto mb-2 mb-lg-0"},p={class:"nav-item"},_=(0,o.Uk)("对战"),m={class:"nav-item"},h=(0,o.Uk)("对局列表"),b={class:"nav-item"},g=(0,o.Uk)("排行榜"),v={key:0,class:"navbar-nav"},f={class:"nav-item dropdown"},k={class:"nav-link dropdown-toggle",href:"#",id:"navbarDropdown",role:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},y={class:"dropdown-menu","aria-labelledby":"navbarDropdown"},w=(0,o.Uk)("我的Bot"),x=(0,o._)("li",null,[(0,o._)("hr",{class:"dropdown-divider"})],-1),C={key:1,class:"navbar-nav"},I={class:"nav-item"},j=(0,o.Uk)(" 登录 "),D={class:"nav-item"},A=(0,o.Uk)(" 注册 ");function O(e,t,s,a,n,O){const z=(0,o.up)("router-link");return(0,o.wg)(),(0,o.iD)("nav",l,[(0,o._)("div",i,[(0,o.Wm)(z,{class:"navbar-brand",to:{name:"home"}},{default:(0,o.w5)((()=>[c])),_:1}),(0,o._)("div",d,[(0,o._)("ul",u,[(0,o._)("li",p,[(0,o.Wm)(z,{class:(0,r.C_)("pk_index"==a.route_name?"nav-link active":"nav-link"),to:{name:"pk_index"}},{default:(0,o.w5)((()=>[_])),_:1},8,["class"])]),(0,o._)("li",m,[(0,o.Wm)(z,{class:(0,r.C_)("record_index"==a.route_name?"nav-link active":"nav-link"),to:{name:"record_index"}},{default:(0,o.w5)((()=>[h])),_:1},8,["class"])]),(0,o._)("li",b,[(0,o.Wm)(z,{class:(0,r.C_)("ranklist_index"==a.route_name?"nav-link active":"nav-link"),to:{name:"ranklist_index"}},{default:(0,o.w5)((()=>[g])),_:1},8,["class"])])]),e.$store.state.user.is_login?((0,o.wg)(),(0,o.iD)("ul",v,[(0,o._)("li",f,[(0,o._)("a",k,(0,r.zw)(e.$store.state.user.username),1),(0,o._)("ul",y,[(0,o._)("li",null,[(0,o.Wm)(z,{class:"dropdown-item",to:{name:"user_bot_index"}},{default:(0,o.w5)((()=>[w])),_:1})]),x,(0,o._)("li",null,[(0,o._)("a",{class:"dropdown-item",href:"#",onClick:t[0]||(t[0]=(...e)=>a.logout&&a.logout(...e))},"退出")])])])])):e.$store.state.user.pulling_info?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("ul",C,[(0,o._)("li",I,[(0,o.Wm)(z,{class:"nav-link",to:{name:"user_account_login"},role:"button"},{default:(0,o.w5)((()=>[j])),_:1})]),(0,o._)("li",D,[(0,o.Wm)(z,{class:"nav-link",to:{name:"user_account_register"},role:"button"},{default:(0,o.w5)((()=>[A])),_:1})])]))])])])}var z=s(2483),S=s(65),M={setup(){const e=(0,S.oR)(),t=(0,z.yj)();let s=(0,o.Fl)((()=>t.name));const a=()=>{e.dispatch("logout")};return{route_name:s,logout:a}}},U=s(89);const B=(0,U.Z)(M,[["render",O]]);var H=B,P=s(5654),$={components:{NavBar:H},setup(){}};const R=(0,U.Z)($,[["render",n]]);var q=R;function L(e,t,s,a,n,r){const l=(0,o.up)("PlayGround"),i=(0,o.up)("MatchGround"),c=(0,o.up)("ResultBoard");return(0,o.wg)(),(0,o.iD)(o.HY,null,["playing"===e.$store.state.pk.status?((0,o.wg)(),(0,o.j4)(l,{key:0})):(0,o.kq)("",!0),"matching"===e.$store.state.pk.status?((0,o.wg)(),(0,o.j4)(i,{key:1})):(0,o.kq)("",!0),"none"!=e.$store.state.pk.loser?((0,o.wg)(),(0,o.j4)(c,{key:2})):(0,o.kq)("",!0)],64)}const F={class:"playground"};function W(e,t,s,a,n,r){const l=(0,o.up)("GameMap");return(0,o.wg)(),(0,o.iD)("div",F,[(0,o.Wm)(l)])}const Z={ref:"parent",class:"gamemap"},V={ref:"canvas",tabindex:"0"};function G(e,t,s,a,n,r){return(0,o.wg)(),(0,o.iD)("div",Z,[(0,o._)("canvas",V,null,512)],512)}const T=[];class N{constructor(){T.push(this),this.timedelta=0,this.has_called_start=!1}start(){}update(){}on_destroy(){}destroy(){this.on_destroy();for(let e in T){const t=T[e];if(t===this){T.splice(e);break}}}}let Y;const E=e=>{for(let t of T)t.has_called_start?(t.timedelta=e-Y,t.update()):(t.has_called_start=!0,t.start());Y=e,requestAnimationFrame(E)};requestAnimationFrame(E);class K extends N{constructor(e,t,s){super(),this.r=e,this.c=t,this.gamemap=s,this.color="#B37226"}update(){this.render()}render(){const e=this.gamemap.L,t=this.gamemap.ctx;t.fillStyle=this.color,t.fillRect(this.c*e,this.r*e,e,e)}}class J{constructor(e,t){this.r=e,this.c=t,this.x=t+.5,this.y=e+.5}}class Q extends N{constructor(e,t){super(),this.id=e.id,this.color=e.color,this.gamemap=t,this.cells=[new J(e.r,e.c)],this.next_cell=null,this.speed=5,this.direction=-1,this.status="idle",this.dr=[-1,0,1,0],this.dc=[0,1,0,-1],this.step=0,this.eps=.01,this.eye_direction=0,1===this.id&&(this.eye_direction=2),this.eye_dx=[[-1,1],[1,1],[1,-1],[-1,-1]],this.eye_dy=[[-1,-1],[-1,1],[1,1],[1,-1]]}start(){}set_direction(e){this.direction=e}check_tail_increasing(){return this.step<=10||this.step%3===1}next_step(){const e=this.direction;this.next_cell=new J(this.cells[0].r+this.dr[e],this.cells[0].c+this.dc[e]),this.eye_direction=e,this.direction=-1,this.status="move",this.step++;const t=this.cells.length;for(let s=t;s>0;s--)this.cells[s]=JSON.parse(JSON.stringify(this.cells[s-1]))}update_move(){const e=this.next_cell.x-this.cells[0].x,t=this.next_cell.y-this.cells[0].y,s=Math.sqrt(e*e+t*t);if(s<this.eps)this.cells[0]=this.next_cell,this.next_cell=null,this.status="idle",this.check_tail_increasing()||this.cells.pop();else{const a=this.speed*this.timedelta/1e3;if(this.cells[0].x+=a*e/s,this.cells[0].y+=a*t/s,!this.check_tail_increasing()){const e=this.cells.length,t=this.cells[e-1],o=this.cells[e-2],n=o.x-t.x,r=o.y-t.y;t.x+=a*n/s,t.y+=a*r/s}}}update(){"move"===this.status&&this.update_move(),this.render()}render(){const e=this.gamemap.L,t=this.gamemap.ctx;t.fillStyle=this.color,"die"===this.status&&(t.fillStyle="white");for(const s of this.cells)t.beginPath(),t.arc(s.x*e,s.y*e,e/2*.8,0,2*Math.PI),t.fill();for(let s=1;s<this.cells.length;s++){const a=this.cells[s-1],o=this.cells[s];Math.abs(a.x-o.x)<this.eps&&Math.abs(a.y-o.y)<this.eps||(Math.abs(a.x-o.x)<this.eps?t.fillRect((a.x-.4)*e,Math.min(a.y,o.y)*e,.8*e,Math.abs(a.y-o.y)*e):t.fillRect(Math.min(a.x,o.x)*e,(a.y-.4)*e,Math.abs(a.x-o.x)*e,.8*e))}t.fillStyle="black";for(let s=0;s<2;s++){const a=(this.cells[0].x+.15*this.eye_dx[this.eye_direction][s])*e,o=(this.cells[0].y+.15*this.eye_dy[this.eye_direction][s])*e;t.beginPath(),t.arc(a,o,.05*e,0,2*Math.PI),t.fill()}}}class X extends N{constructor(e,t,s){super(),this.ctx=e,this.parent=t,this.store=s,this.L=0,this.rows=13,this.cols=14,this.inner_walls_count=20,this.walls=[],this.snakes=[new Q({id:0,color:"#4876EC",r:this.rows-2,c:1},this),new Q({id:1,color:"#F94848",r:1,c:this.cols-2},this)]}create_walls(){const e=this.store.state.pk.gamemap;for(let t=0;t<this.rows;t++)for(let s=0;s<this.cols;s++)e[t][s]&&this.walls.push(new K(t,s,this))}add_listening_events(){if(console.log(this.store.state.record),this.store.state.record.is_record){let e=0;const t=this.store.state.record.a_steps,s=this.store.state.record.b_steps,a=this.store.state.record.record_loser,[o,n]=this.snakes,r=setInterval((()=>{e>=t.length-1?("all"!==a&&"A"!==a||(o.status="die"),"all"!==a&&"B"!==a||(n.status="die"),clearInterval(r)):(o.set_direction(parseInt(t[e])),n.set_direction(parseInt(s[e]))),e++}),300)}else this.ctx.canvas.focus(),this.ctx.canvas.addEventListener("keydown",(e=>{let t=-1;"w"===e.key?t=0:"d"===e.key?t=1:"s"===e.key?t=2:"a"===e.key&&(t=3),t>=0&&this.store.state.pk.socket.send(JSON.stringify({event:"move",direction:t}))}))}start(){this.create_walls(),this.add_listening_events()}update_size(){this.L=parseInt(Math.min(this.parent.clientWidth/this.cols,this.parent.clientHeight/this.rows)),this.ctx.canvas.width=this.L*this.cols,this.ctx.canvas.height=this.L*this.rows}check_ready(){for(const e of this.snakes){if("idle"!==e.status)return!1;if(-1===e.direction)return!1}return!0}next_step(){for(const e of this.snakes)e.next_step()}check_valid(e){for(const t of this.walls)if(t.r===e.r&&t.c===e.c)return!1;for(const t of this.snakes){let s=t.cells.length;t.check_tail_increasing()||s--;for(let a=0;a<s;a++)if(t.cells[a].r===e.r&&t.cells[a].c===e.c)return!1}return!0}update(){this.update_size(),this.check_ready()&&this.next_step(),this.render()}render(){const e="#AAD751",t="#A2D149";for(let s=0;s<this.rows;s++)for(let a=0;a<this.cols;a++)this.ctx.fillStyle=(s+a)%2==0?e:t,this.ctx.fillRect(a*this.L,s*this.L,this.L,this.L)}}var ee=s(4870),te={setup(){const e=(0,S.oR)();let t=(0,ee.iH)(null),s=(0,ee.iH)(null);return(0,o.bv)((()=>{e.commit("updateGameObject",new X(s.value.getContext("2d"),t.value,e))})),{parent:t,canvas:s}}};const se=(0,U.Z)(te,[["render",G],["__scopeId","data-v-0ae5d7f6"]]);var ae=se,oe={components:{GameMap:ae}};const ne=(0,U.Z)(oe,[["render",W],["__scopeId","data-v-656d9b26"]]);var re=ne;const le=e=>((0,o.dD)("data-v-c84259d6"),e=e(),(0,o.Cn)(),e),ie={class:"matchground"},ce={class:"row"},de={class:"col-4"},ue={class:"user-photo"},pe=["src"],_e={class:"user-username"},me={class:"col-4"},he={class:"user-select-bot"},be=le((()=>(0,o._)("option",{value:"-1",selected:""},"亲自出马",-1))),ge=["value"],ve={class:"col-4"},fe={class:"user-photo"},ke=["src"],ye={class:"user-username"},we={class:"col-12",style:{"text-align":"center","padding-top":"15vh"}};function xe(e,t,s,n,l,i){return(0,o.wg)(),(0,o.iD)("div",ie,[(0,o._)("div",ce,[(0,o._)("div",de,[(0,o._)("div",ue,[(0,o._)("img",{src:e.$store.state.user.photo,alt:""},null,8,pe)]),(0,o._)("div",_e,(0,r.zw)(e.$store.state.user.username),1)]),(0,o._)("div",me,[(0,o._)("div",he,[(0,o.wy)((0,o._)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.select_bot=e),class:"form-select","aria-label":"Default select example"},[be,((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.bots,(e=>((0,o.wg)(),(0,o.iD)("option",{key:e.id,value:e.id},(0,r.zw)(e.title),9,ge)))),128))],512),[[a.bM,n.select_bot]])])]),(0,o._)("div",ve,[(0,o._)("div",fe,[(0,o._)("img",{src:e.$store.state.pk.opponent_photo,alt:""},null,8,ke)]),(0,o._)("div",ye,(0,r.zw)(e.$store.state.pk.opponent_username),1)]),(0,o._)("div",we,[(0,o._)("button",{onClick:t[1]||(t[1]=(...e)=>n.click_match_btn&&n.click_match_btn(...e)),type:"button",class:"btn btn-warning btn-lg"},(0,r.zw)(n.match_btn_info),1)])])])}var Ce=s(7387),Ie=s.n(Ce),je={setup(){const e=(0,S.oR)();let t=(0,ee.iH)("开始匹配"),s=(0,ee.iH)([]),a=(0,ee.iH)("-1");const o=()=>{"开始匹配"===t.value?(t.value="取消",e.state.pk.socket.send(JSON.stringify({event:"start-matching",bot_id:a.value}))):(t.value="开始匹配",e.state.pk.socket.send(JSON.stringify({event:"stop-matching"})))},n=()=>{Ie().ajax({url:"http://backend:3000/api/user/bot/getlist/",type:"get",headers:{Authorization:"Bearer "+e.state.user.token},success(e){s.value=e}})};return n(),{match_btn_info:t,click_match_btn:o,bots:s,select_bot:a}}};const De=(0,U.Z)(je,[["render",xe],["__scopeId","data-v-c84259d6"]]);var Ae=De;const Oe={class:"result-board"},ze={key:0,class:"result-board-text"},Se={key:1,class:"result-board-text"},Me={key:2,class:"result-board-text"},Ue={key:3,class:"result-board-text"},Be={class:"result-board-btn"};function He(e,t,s,a,n,r){return(0,o.wg)(),(0,o.iD)("div",Oe,["all"===e.$store.state.pk.loser?((0,o.wg)(),(0,o.iD)("div",ze," Draw ")):"A"===e.$store.state.pk.loser&&e.$store.state.pk.a_id===parseInt(e.$store.state.user.id)?((0,o.wg)(),(0,o.iD)("div",Se," Lose ")):"B"===e.$store.state.pk.loser&&e.$store.state.pk.b_id===parseInt(e.$store.state.user.id)?((0,o.wg)(),(0,o.iD)("div",Me," Lose ")):((0,o.wg)(),(0,o.iD)("div",Ue," Win ")),(0,o._)("div",Be,[(0,o._)("button",{onClick:t[0]||(t[0]=(...e)=>a.restart&&a.restart(...e)),type:"button",class:"btn btn-warning btn-lg"}," 再来! ")])])}var Pe={setup(){const e=(0,S.oR)(),t=()=>{e.commit("updateStatus","matching"),e.commit("updateLoser","none"),e.commit("updateOpponent",{username:"我的对手",photo:"https://cdn.acwing.com/media/article/image/2022/08/09/1_1db2488f17-anonymous.png"})};return{restart:t}}};const $e=(0,U.Z)(Pe,[["render",He],["__scopeId","data-v-34e201d5"]]);var Re=$e,qe={components:{PlayGround:re,MatchGround:Ae,ResultBoard:Re},setup(){const e=(0,S.oR)(),t=`ws://backend:3000/websocket/${e.state.user.token}/`;e.commit("updateLoser","none"),e.commit("updateIsRecord",!1);let s=null;(0,o.bv)((()=>{e.commit("updateOpponent",{username:"我的对手",photo:"https://cdn.acwing.com/media/article/image/2022/08/09/1_1db2488f17-anonymous.png"}),s=new WebSocket(t),s.onopen=()=>{console.log("connected!"),e.commit("updateSocket",s)},s.onmessage=t=>{const s=JSON.parse(t.data);if("start-matching"===s.event)e.commit("updateOpponent",{username:s.opponent_username,photo:s.opponent_photo}),setTimeout((()=>{e.commit("updateStatus","playing")}),200),e.commit("updateGame",s.game);else if("move"===s.event){console.log(s);const t=e.state.pk.gameObject,[a,o]=t.snakes;a.set_direction(s.a_direction),o.set_direction(s.b_direction)}else if("result"===s.event){console.log(s);const t=e.state.pk.gameObject,[a,o]=t.snakes;"all"!==s.loser&&"A"!==s.loser||(a.status="die"),"all"!==s.loser&&"B"!==s.loser||(o.status="die"),e.commit("updateLoser",s.loser)}},s.onclose=()=>{console.log("disconnected!")}})),(0,o.Ah)((()=>{s.close(),e.commit("updateStatus","matching")}))}};const Le=(0,U.Z)(qe,[["render",L]]);var Fe=Le;const We=e=>((0,o.dD)("data-v-6e7b27b1"),e=e(),(0,o.Cn)(),e),Ze={class:"table table-striped table-hover",style:{"text-align":"center"}},Ve=We((()=>(0,o._)("thead",null,[(0,o._)("tr",null,[(0,o._)("th",null,"A"),(0,o._)("th",null,"B"),(0,o._)("th",null,"对战结果"),(0,o._)("th",null,"对战时间"),(0,o._)("th",null,"操作")])],-1))),Ge=["src"],Te=(0,o.Uk)("   "),Ne={class:"record-user-username"},Ye=["src"],Ee=(0,o.Uk)("   "),Ke={class:"record-user-username"},Je=["onClick"],Qe={"aria-label":"..."},Xe={class:"pagination",style:{float:"right"}},et=We((()=>(0,o._)("a",{class:"page-link",href:"#"},"前一页",-1))),tt=[et],st=["onClick"],at={class:"page-link",href:"#"},ot=We((()=>(0,o._)("a",{class:"page-link",href:"#"},"后一页",-1))),nt=[ot];function rt(e,t,s,a,n,l){const i=(0,o.up)("ContentField");return(0,o.wg)(),(0,o.j4)(i,null,{default:(0,o.w5)((()=>[(0,o._)("table",Ze,[Ve,(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(a.records,(e=>((0,o.wg)(),(0,o.iD)("tr",{key:e.record.id},[(0,o._)("td",null,[(0,o._)("img",{src:e.a_photo,alt:"",class:"record-user-photo"},null,8,Ge),Te,(0,o._)("span",Ne,(0,r.zw)(e.a_username),1)]),(0,o._)("td",null,[(0,o._)("img",{src:e.b_photo,alt:"",class:"record-user-photo"},null,8,Ye),Ee,(0,o._)("span",Ke,(0,r.zw)(e.b_username),1)]),(0,o._)("td",null,(0,r.zw)(e.result),1),(0,o._)("td",null,(0,r.zw)(e.record.createtime),1),(0,o._)("td",null,[(0,o._)("button",{onClick:t=>a.open_record_content(e.record.id),type:"button",class:"btn btn-secondary"},"查看录像",8,Je)])])))),128))])]),(0,o._)("nav",Qe,[(0,o._)("ul",Xe,[(0,o._)("li",{class:"page-item",onClick:t[0]||(t[0]=e=>a.click_page(-2))},tt),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(a.pages,(e=>((0,o.wg)(),(0,o.iD)("li",{class:(0,r.C_)("page-item "+e.is_active),key:e.number,onClick:t=>a.click_page(e.number)},[(0,o._)("a",at,(0,r.zw)(e.number),1)],10,st)))),128)),(0,o._)("li",{class:"page-item",onClick:t[1]||(t[1]=e=>a.click_page(-1))},nt)])])])),_:1})}const lt={class:"container content-field"},it={class:"card"},ct={class:"card-body"};function dt(e,t){return(0,o.wg)(),(0,o.iD)("div",lt,[(0,o._)("div",it,[(0,o._)("div",ct,[(0,o.WI)(e.$slots,"default",{},void 0,!0)])])])}const ut={},pt=(0,U.Z)(ut,[["render",dt],["__scopeId","data-v-01b1c26b"]]);var _t=pt,mt={components:{ContentField:_t},setup(){const e=(0,S.oR)();let t=(0,ee.iH)([]),s=1,a=0,o=(0,ee.iH)([]);const n=e=>{-2===e?e=s-1:-1===e&&(e=s+1);let t=parseInt(Math.ceil(a/10));e>=1&&e<=t&&l(e)},r=()=>{let e=parseInt(Math.ceil(a/10)),t=[];for(let a=s-2;a<=s+2;a++)a>=1&&a<=e&&t.push({number:a,is_active:a===s?"active":""});o.value=t},l=o=>{s=o,Ie().ajax({url:"http://backend:3000/api/record/getlist/",data:{page:o},type:"get",headers:{Authorization:"Bearer "+e.state.user.token},success(e){t.value=e.records,a=e.records_count,r()},error(e){console.log(e)}})};l(s);const i=e=>{let t=[];for(let s=0,a=0;s<13;s++){let s=[];for(let t=0;t<14;t++,a++)"0"===e[a]?s.push(0):s.push(1);t.push(s)}return t},c=s=>{for(const a of t.value)if(a.record.id===s){e.commit("updateIsRecord",!0),e.commit("updateGame",{map:i(a.record.map),a_id:a.record.aid,a_sx:a.record.asx,a_sy:a.record.asy,b_id:a.record.bid,b_sx:a.record.bsx,b_sy:a.record.bsy}),e.commit("updateSteps",{a_steps:a.record.asteps,b_steps:a.record.bsteps}),e.commit("updateRecordLoser",a.record.loser),Ia.push({name:"record_content",params:{recordId:s}});break}};return{records:t,open_record_content:c,pages:o,click_page:n}}};const ht=(0,U.Z)(mt,[["render",rt],["__scopeId","data-v-6e7b27b1"]]);var bt=ht;function gt(e,t,s,a,n,r){const l=(0,o.up)("PlayGround");return(0,o.wg)(),(0,o.j4)(l)}var vt={components:{PlayGround:re},setup(){}};const ft=(0,U.Z)(vt,[["render",gt]]);var kt=ft;const yt=e=>((0,o.dD)("data-v-19b7c029"),e=e(),(0,o.Cn)(),e),wt={class:"table table-striped table-hover",style:{"text-align":"center"}},xt=yt((()=>(0,o._)("thead",null,[(0,o._)("tr",null,[(0,o._)("th",null,"玩家"),(0,o._)("th",null,"天梯分")])],-1))),Ct=["src"],It=(0,o.Uk)("   "),jt={class:"record-user-username"},Dt={"aria-label":"..."},At={class:"pagination",style:{float:"right"}},Ot=yt((()=>(0,o._)("a",{class:"page-link",href:"#"},"前一页",-1))),zt=[Ot],St=["onClick"],Mt={class:"page-link",href:"#"},Ut=yt((()=>(0,o._)("a",{class:"page-link",href:"#"},"后一页",-1))),Bt=[Ut];function Ht(e,t,s,a,n,l){const i=(0,o.up)("ContentField");return(0,o.wg)(),(0,o.j4)(i,null,{default:(0,o.w5)((()=>[(0,o._)("table",wt,[xt,(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(a.users,(e=>((0,o.wg)(),(0,o.iD)("tr",{key:e.id},[(0,o._)("td",null,[(0,o._)("img",{src:e.photo,alt:"",class:"record-user-photo"},null,8,Ct),It,(0,o._)("span",jt,(0,r.zw)(e.username),1)]),(0,o._)("td",null,(0,r.zw)(e.rating),1)])))),128))])]),(0,o._)("nav",Dt,[(0,o._)("ul",At,[(0,o._)("li",{class:"page-item",onClick:t[0]||(t[0]=e=>a.click_page(-2))},zt),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(a.pages,(e=>((0,o.wg)(),(0,o.iD)("li",{class:(0,r.C_)("page-item "+e.is_active),key:e.number,onClick:t=>a.click_page(e.number)},[(0,o._)("a",Mt,(0,r.zw)(e.number),1)],10,St)))),128)),(0,o._)("li",{class:"page-item",onClick:t[1]||(t[1]=e=>a.click_page(-1))},Bt)])])])),_:1})}var Pt={components:{ContentField:_t},setup(){const e=(0,S.oR)();let t=(0,ee.iH)([]),s=1,a=0,o=(0,ee.iH)([]);const n=e=>{-2===e?e=s-1:-1===e&&(e=s+1);let t=parseInt(Math.ceil(a/3));e>=1&&e<=t&&l(e)},r=()=>{let e=parseInt(Math.ceil(a/3)),t=[];for(let a=s-2;a<=s+2;a++)a>=1&&a<=e&&t.push({number:a,is_active:a===s?"active":""});o.value=t},l=o=>{s=o,Ie().ajax({url:"http://backend:3000/api/ranklist/getlist/",data:{page:o},type:"get",headers:{Authorization:"Bearer "+e.state.user.token},success(e){t.value=e.users,console.log(t.value),a=e.users_count,r()},error(e){console.log(e)}})};return l(s),{users:t,pages:o,click_page:n}}};const $t=(0,U.Z)(Pt,[["render",Ht],["__scopeId","data-v-19b7c029"]]);var Rt=$t;const qt=e=>((0,o.dD)("data-v-dd41fed2"),e=e(),(0,o.Cn)(),e),Lt={class:"container"},Ft={class:"row"},Wt={class:"col-3"},Zt={class:"card",style:{"margin-top":"20px"}},Vt={class:"card-body"},Gt=["src"],Tt={class:"col-9"},Nt={class:"card",style:{"margin-top":"20px"}},Yt={class:"card-header"},Et=qt((()=>(0,o._)("span",{style:{"font-size":"130%"}},"我的Bot",-1))),Kt=qt((()=>(0,o._)("button",{type:"button",class:"btn btn-primary float-end","data-bs-toggle":"modal","data-bs-target":"#add-bot-btn"}," 创建Bot ",-1))),Jt={class:"modal fade",id:"add-bot-btn",tabindex:"-1"},Qt={class:"modal-dialog modal-xl"},Xt={class:"modal-content"},es=qt((()=>(0,o._)("div",{class:"modal-header"},[(0,o._)("h5",{class:"modal-title"},"创建Bot"),(0,o._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1))),ts={class:"modal-body"},ss={class:"mb-3"},as=qt((()=>(0,o._)("label",{for:"add-bot-title",class:"form-label"},"名称",-1))),os={class:"mb-3"},ns=qt((()=>(0,o._)("label",{for:"add-bot-description",class:"form-label"},"简介",-1))),rs={class:"mb-3"},ls=qt((()=>(0,o._)("label",{for:"add-bot-code",class:"form-label"},"代码",-1))),is={class:"modal-footer"},cs={class:"error-message"},ds=qt((()=>(0,o._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1))),us={class:"card-body"},ps={class:"table table-striped table-hover"},_s=qt((()=>(0,o._)("thead",null,[(0,o._)("tr",null,[(0,o._)("th",null,"名称"),(0,o._)("th",null,"创建时间"),(0,o._)("th",null,"操作")])],-1))),ms=["data-bs-target"],hs=["onClick"],bs=["id"],gs={class:"modal-dialog modal-xl"},vs={class:"modal-content"},fs=qt((()=>(0,o._)("div",{class:"modal-header"},[(0,o._)("h5",{class:"modal-title"},"创建Bot"),(0,o._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1))),ks={class:"modal-body"},ys={class:"mb-3"},ws=qt((()=>(0,o._)("label",{for:"add-bot-title",class:"form-label"},"名称",-1))),xs=["onUpdate:modelValue"],Cs={class:"mb-3"},Is=qt((()=>(0,o._)("label",{for:"add-bot-description",class:"form-label"},"简介",-1))),js=["onUpdate:modelValue"],Ds={class:"mb-3"},As=qt((()=>(0,o._)("label",{for:"add-bot-code",class:"form-label"},"代码",-1))),Os={class:"modal-footer"},zs={class:"error-message"},Ss=["onClick"],Ms=qt((()=>(0,o._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1)));function Us(e,t,s,n,l,i){const c=(0,o.up)("VAceEditor");return(0,o.wg)(),(0,o.iD)("div",Lt,[(0,o._)("div",Ft,[(0,o._)("div",Wt,[(0,o._)("div",Zt,[(0,o._)("div",Vt,[(0,o._)("img",{src:e.$store.state.user.photo,alt:"",style:{width:"100%"}},null,8,Gt)])])]),(0,o._)("div",Tt,[(0,o._)("div",Nt,[(0,o._)("div",Yt,[Et,Kt,(0,o._)("div",Jt,[(0,o._)("div",Qt,[(0,o._)("div",Xt,[es,(0,o._)("div",ts,[(0,o._)("div",ss,[as,(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.botadd.title=e),type:"text",class:"form-control",id:"add-bot-title",placeholder:"请输入Bot名称"},null,512),[[a.nr,n.botadd.title]])]),(0,o._)("div",os,[ns,(0,o.wy)((0,o._)("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>n.botadd.description=e),class:"form-control",id:"add-bot-description",rows:"3",placeholder:"请输入Bot简介"},null,512),[[a.nr,n.botadd.description]])]),(0,o._)("div",rs,[ls,(0,o.Wm)(c,{value:n.botadd.content,"onUpdate:value":t[2]||(t[2]=e=>n.botadd.content=e),onInit:e.editorInit,lang:"c_cpp",theme:"textmate",style:{height:"300px"}},null,8,["value","onInit"])])]),(0,o._)("div",is,[(0,o._)("div",cs,(0,r.zw)(n.botadd.error_message),1),(0,o._)("button",{type:"button",class:"btn btn-primary",onClick:t[3]||(t[3]=(...e)=>n.add_bot&&n.add_bot(...e))},"创建"),ds])])])])]),(0,o._)("div",us,[(0,o._)("table",ps,[_s,(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.bots,(t=>((0,o.wg)(),(0,o.iD)("tr",{key:t.id},[(0,o._)("td",null,(0,r.zw)(t.title),1),(0,o._)("td",null,(0,r.zw)(t.createtime),1),(0,o._)("td",null,[(0,o._)("button",{type:"button",class:"btn btn-secondary",style:{"margin-right":"10px"},"data-bs-toggle":"modal","data-bs-target":"#update-bot-modal-"+t.id},"修改",8,ms),(0,o._)("button",{type:"button",class:"btn btn-danger",onClick:e=>n.remove_bot(t)},"删除",8,hs),(0,o._)("div",{class:"modal fade",id:"update-bot-modal-"+t.id,tabindex:"-1"},[(0,o._)("div",gs,[(0,o._)("div",vs,[fs,(0,o._)("div",ks,[(0,o._)("div",ys,[ws,(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":e=>t.title=e,type:"text",class:"form-control",id:"add-bot-title",placeholder:"请输入Bot名称"},null,8,xs),[[a.nr,t.title]])]),(0,o._)("div",Cs,[Is,(0,o.wy)((0,o._)("textarea",{"onUpdate:modelValue":e=>t.description=e,class:"form-control",id:"add-bot-description",rows:"3",placeholder:"请输入Bot简介"},null,8,js),[[a.nr,t.description]])]),(0,o._)("div",Ds,[As,(0,o.Wm)(c,{value:t.content,"onUpdate:value":e=>t.content=e,onInit:e.editorInit,lang:"c_cpp",theme:"textmate",style:{height:"300px"}},null,8,["value","onUpdate:value","onInit"])])]),(0,o._)("div",Os,[(0,o._)("div",zs,(0,r.zw)(t.error_message),1),(0,o._)("button",{type:"button",class:"btn btn-primary",onClick:e=>n.update_bot(t)},"保存修改",8,Ss),Ms])])])],8,bs)])])))),128))])])])])])])])}var Bs=s(6092),Hs=s(17),Ps=s.n(Hs),$s={components:{VAceEditor:Bs.m},setup(){Ps().config.set("basePath","https://cdn.jsdelivr.net/npm/ace-builds@"+s(17).version+"/src-noconflict/");const e=(0,S.oR)();let t=(0,ee.iH)([]);const a=(0,ee.qj)({title:"",description:"",content:"",error_message:""}),o=()=>{Ie().ajax({url:"http://backend:3000/api/user/bot/getlist/",type:"get",headers:{Authorization:"Bearer "+e.state.user.token},success(e){t.value=e}})};o();const n=()=>{a.error_message="",Ie().ajax({url:"http://backend:3000/api/user/bot/add/",type:"post",data:{title:a.title,description:a.description,content:a.content},headers:{Authorization:"Bearer "+e.state.user.token},success(e){"success"===e.error_message?(a.title="",a.description="",a.content="",P.Modal.getInstance("#add-bot-btn").hide(),o()):a.error_message=e.error_message}})},r=t=>{a.error_message="",Ie().ajax({url:"http://backend:3000/api/user/bot/update/",type:"post",data:{bot_id:t.id,title:t.title,description:t.description,content:t.content},headers:{Authorization:"Bearer "+e.state.user.token},success(e){"success"===e.error_message?(P.Modal.getInstance("#update-bot-modal-"+t.id).hide(),o()):a.error_message=e.error_message}})},l=t=>{Ie().ajax({url:"http://backend:3000/api/user/bot/remove/",type:"post",data:{bot_id:t.id},headers:{Authorization:"Bearer "+e.state.user.token},success(e){"success"===e.error_message&&o()}})};return{bots:t,botadd:a,add_bot:n,update_bot:r,remove_bot:l}}};const Rs=(0,U.Z)($s,[["render",Us],["__scopeId","data-v-dd41fed2"]]);var qs=Rs;const Ls=(0,o.Uk)(" 404 Not Found ");function Fs(e,t,s,a,n,r){const l=(0,o.up)("ContentField");return(0,o.wg)(),(0,o.j4)(l,null,{default:(0,o.w5)((()=>[Ls])),_:1})}var Ws={components:{ContentField:_t}};const Zs=(0,U.Z)(Ws,[["render",Fs]]);var Vs=Zs;const Gs=e=>((0,o.dD)("data-v-94bc6d70"),e=e(),(0,o.Cn)(),e),Ts={class:"row justify-content-md-center"},Ns={class:"col-3"},Ys={class:"mb-3"},Es=Gs((()=>(0,o._)("label",{for:"username",class:"form-label"},"用户名",-1))),Ks={class:"mb-3"},Js=Gs((()=>(0,o._)("label",{for:"password",class:"form-label"},"密码",-1))),Qs={class:"error-message"},Xs=Gs((()=>(0,o._)("button",{type:"submit",class:"btn btn-primary"},"提交",-1)));function ea(e,t,s,n,l,i){const c=(0,o.up)("ContentField");return e.$store.state.user.pulling_info?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(c,{key:0},{default:(0,o.w5)((()=>[(0,o._)("div",Ts,[(0,o._)("div",Ns,[(0,o._)("form",{onSubmit:t[2]||(t[2]=(0,a.iM)(((...e)=>n.login&&n.login(...e)),["prevent"]))},[(0,o._)("div",Ys,[Es,(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.username=e),type:"text",class:"form-control",id:"username",placeholder:"请输入用户名"},null,512),[[a.nr,n.username]])]),(0,o._)("div",Ks,[Js,(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>n.password=e),type:"password",class:"form-control",id:"password",placeholder:"请输入密码"},null,512),[[a.nr,n.password]])]),(0,o._)("div",Qs,(0,r.zw)(n.error_message),1),Xs],32)])])])),_:1}))}var ta={components:{ContentField:_t},setup(){const e=(0,S.oR)();let t=(0,ee.iH)(""),s=(0,ee.iH)(""),a=(0,ee.iH)("");const o=localStorage.getItem("jwt_token");o?(e.commit("updateToken",o),e.dispatch("getinfo",{success(){Ia.push({name:"home"}),e.commit("updatePullingInfo",!1)},error(){e.commit("updatePullingInfo",!1)}})):e.commit("updatePullingInfo",!1);const n=()=>{a.value="",e.dispatch("login",{username:t.value,password:s.value,success(){e.dispatch("getinfo",{success(){Ia.push({name:"home"})}})},error(){a.value="用户名或密码错误"}})};return{username:t,password:s,error_message:a,login:n}}};const sa=(0,U.Z)(ta,[["render",ea],["__scopeId","data-v-94bc6d70"]]);var aa=sa;const oa=e=>((0,o.dD)("data-v-d820f0b6"),e=e(),(0,o.Cn)(),e),na={class:"row justify-content-md-center"},ra={class:"col-3"},la={class:"mb-3"},ia=oa((()=>(0,o._)("label",{for:"username",class:"form-label"},"用户名",-1))),ca={class:"mb-3"},da=oa((()=>(0,o._)("label",{for:"password",class:"form-label"},"密码",-1))),ua={class:"mb-3"},pa=oa((()=>(0,o._)("label",{for:"confirmedPassword",class:"form-label"},"确认密码",-1))),_a={class:"error-message"},ma=oa((()=>(0,o._)("button",{type:"submit",class:"btn btn-primary"},"提交",-1)));function ha(e,t,s,n,l,i){const c=(0,o.up)("ContentField");return(0,o.wg)(),(0,o.j4)(c,null,{default:(0,o.w5)((()=>[(0,o._)("div",na,[(0,o._)("div",ra,[(0,o._)("form",{onSubmit:t[3]||(t[3]=(0,a.iM)(((...e)=>n.register&&n.register(...e)),["prevent"]))},[(0,o._)("div",la,[ia,(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.username=e),type:"text",class:"form-control",id:"username",placeholder:"请输入用户名"},null,512),[[a.nr,n.username]])]),(0,o._)("div",ca,[da,(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>n.password=e),type:"password",class:"form-control",id:"password",placeholder:"请输入密码"},null,512),[[a.nr,n.password]])]),(0,o._)("div",ua,[pa,(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>n.confirmedPassword=e),type:"password",class:"form-control",id:"confirmedPassword",placeholder:"请再次输入密码"},null,512),[[a.nr,n.confirmedPassword]])]),(0,o._)("div",_a,(0,r.zw)(n.error_message),1),ma],32)])])])),_:1})}var ba={components:{ContentField:_t},setup(){let e=(0,ee.iH)(""),t=(0,ee.iH)(""),s=(0,ee.iH)(""),a=(0,ee.iH)("");const o=()=>{Ie().ajax({url:"http://backend:3000/api/user/account/register/",type:"post",data:{username:e.value,password:t.value,confirmedPassword:s.value},success(e){"success"===e.error_message?Ia.push({name:"user_account_login"}):a.value=e.error_message}})};return{username:e,password:t,confirmedPassword:s,error_message:a,register:o}}};const ga=(0,U.Z)(ba,[["render",ha],["__scopeId","data-v-d820f0b6"]]);var va=ga,fa={state:{id:"",username:"",photo:"",token:"",is_login:!1,pulling_info:!0},getters:{},mutations:{updateUser(e,t){e.id=t.id,e.username=t.username,e.photo=t.photo,e.is_login=t.is_login},updateToken(e,t){e.token=t},logout(e){e.id="",e.username="",e.photo="",e.token="",e.is_login=!1},updatePullingInfo(e,t){e.pulling_info=t}},actions:{login(e,t){Ie().ajax({url:"http://backend:3000/api/user/account/token/",type:"post",data:{username:t.username,password:t.password},success(s){"success"===s.error_message?(localStorage.setItem("jwt_token",s.token),e.commit("updateToken",s.token),t.success(s)):t.error(s)},error(e){t.error(e)}})},getinfo(e,t){Ie().ajax({url:"http://backend:3000/api/user/account/info/",type:"get",headers:{Authorization:"Bearer "+e.state.token},success(s){"success"===s.error_message?(e.commit("updateUser",{...s,is_login:!0}),t.success(s)):t.error(s)},error(e){t.error(e)}})},logout(e){localStorage.removeItem("jwt_token"),e.commit("logout")}},modules:{}},ka={state:{status:"matching",socket:null,opponent_username:"",opponent_photo:"",gamemap:null,a_id:0,a_sx:0,a_sy:0,b_id:0,b_sx:0,b_sy:0,gameObject:null,loser:"none"},getters:{},mutations:{updateSocket(e,t){e.socket=t},updateOpponent(e,t){e.opponent_username=t.username,e.opponent_photo=t.photo},updateStatus(e,t){e.status=t},updateGame(e,t){e.gamemap=t.map,e.a_id=t.a_id,e.a_sx=t.a_sx,e.a_sy=t.a_sy,e.b_id=t.b_id,e.b_sx=t.b_sx,e.b_sy=t.b_sy},updateGameObject(e,t){e.gameObject=t},updateLoser(e,t){e.loser=t}},actions:{},modules:{}},ya={state:{is_record:!1,a_steps:"",b_steps:"",record_loser:""},getters:{},mutations:{updateIsRecord(e,t){e.is_record=t},updateSteps(e,t){e.a_steps=t.a_steps,e.b_steps=t.b_steps},updateRecordLoser(e,t){e.record_loser=t}},actions:{},modules:{}},wa=(0,S.MT)({state:{},getters:{},mutations:{},actions:{},modules:{user:fa,pk:ka,record:ya}});const xa=[{path:"/",name:"home",redirect:"/pk/",meta:{requestAuth:!0}},{path:"/pk/",name:"pk_index",component:Fe,meta:{requestAuth:!0}},{path:"/record/",name:"record_index",component:bt,meta:{requestAuth:!0}},{path:"/record/:recordId/",name:"record_content",component:kt,meta:{requestAuth:!0}},{path:"/ranklist/",name:"ranklist_index",component:Rt,meta:{requestAuth:!0}},{path:"/user/bot/",name:"user_bot_index",component:qs,meta:{requestAuth:!0}},{path:"/user/account/login/",name:"user_account_login",component:aa,meta:{requestAuth:!1}},{path:"/user/account/register/",name:"user_account_register",component:va,meta:{requestAuth:!1}},{path:"/404/",name:"404",component:Vs,meta:{requestAuth:!1}},{path:"/:catchAll(.*)",redirect:"/404/"}],Ca=(0,z.p7)({history:(0,z.PO)(),routes:xa});Ca.beforeEach(((e,t,s)=>{e.meta.requestAuth&&!wa.state.user.is_login?s({name:"user_account_login"}):s()}));var Ia=Ca;(0,a.ri)(q).use(wa).use(Ia).mount("#app")}},t={};function s(a){var o=t[a];if(void 0!==o)return o.exports;var n=t[a]={id:a,loaded:!1,exports:{}};return e[a].call(n.exports,n,n.exports,s),n.loaded=!0,n.exports}s.m=e,function(){s.amdD=function(){throw new Error("define cannot be used indirect")}}(),function(){var e=[];s.O=function(t,a,o,n){if(!a){var r=1/0;for(d=0;d<e.length;d++){a=e[d][0],o=e[d][1],n=e[d][2];for(var l=!0,i=0;i<a.length;i++)(!1&n||r>=n)&&Object.keys(s.O).every((function(e){return s.O[e](a[i])}))?a.splice(i--,1):(l=!1,n<r&&(r=n));if(l){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[a,o,n]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){s.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={143:0};s.O.j=function(t){return 0===e[t]};var t=function(t,a){var o,n,r=a[0],l=a[1],i=a[2],c=0;if(r.some((function(t){return 0!==e[t]}))){for(o in l)s.o(l,o)&&(s.m[o]=l[o]);if(i)var d=i(s)}for(t&&t(a);c<r.length;c++)n=r[c],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(d)},a=self["webpackChunkweb"]=self["webpackChunkweb"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=s.O(void 0,[998],(function(){return s(906)}));a=s.O(a)})();
//# sourceMappingURL=app.d638a24c.js.map