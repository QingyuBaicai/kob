(function(){"use strict";var t={6479:function(t,e,s){var a=s(9242),o=s(3396);function n(t,e,s,a,n,r){const l=(0,o.up)("NavBar"),i=(0,o.up)("router-view");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(l),(0,o.Wm)(i)],64)}var r=s(7139);const l={class:"navbar navbar-expand-lg navbar-dark bg-dark"},i={class:"container"},c=(0,o.Uk)("King Of Bots"),d={class:"collapse navbar-collapse",id:"navbarText"},u={class:"navbar-nav me-auto mb-2 mb-lg-0"},p={class:"nav-item"},_=(0,o.Uk)("对战"),m={class:"nav-item"},h=(0,o.Uk)("对局列表"),b={class:"nav-item"},g=(0,o.Uk)("排行榜"),v={key:0,class:"navbar-nav"},f={class:"nav-item dropdown"},y={class:"nav-link dropdown-toggle",href:"#",id:"navbarDropdown",role:"button","data-bs-toggle":"dropdown","aria-expanded":"false"},k={class:"dropdown-menu","aria-labelledby":"navbarDropdown"},w=(0,o.Uk)("我的Bot"),x=(0,o._)("li",null,[(0,o._)("hr",{class:"dropdown-divider"})],-1),C={key:1,class:"navbar-nav"},I={class:"nav-item"},j=(0,o.Uk)(" 登录 "),D={class:"nav-item"},A=(0,o.Uk)(" 注册 ");function O(t,e,s,a,n,O){const z=(0,o.up)("router-link");return(0,o.wg)(),(0,o.iD)("nav",l,[(0,o._)("div",i,[(0,o.Wm)(z,{class:"navbar-brand",to:{name:"home"}},{default:(0,o.w5)((()=>[c])),_:1}),(0,o._)("div",d,[(0,o._)("ul",u,[(0,o._)("li",p,[(0,o.Wm)(z,{class:(0,r.C_)("pk_index"==a.route_name?"nav-link active":"nav-link"),to:{name:"pk_index"}},{default:(0,o.w5)((()=>[_])),_:1},8,["class"])]),(0,o._)("li",m,[(0,o.Wm)(z,{class:(0,r.C_)("record_index"==a.route_name?"nav-link active":"nav-link"),to:{name:"record_index"}},{default:(0,o.w5)((()=>[h])),_:1},8,["class"])]),(0,o._)("li",b,[(0,o.Wm)(z,{class:(0,r.C_)("ranklist_index"==a.route_name?"nav-link active":"nav-link"),to:{name:"ranklist_index"}},{default:(0,o.w5)((()=>[g])),_:1},8,["class"])])]),t.$store.state.user.is_login?((0,o.wg)(),(0,o.iD)("ul",v,[(0,o._)("li",f,[(0,o._)("a",y,(0,r.zw)(t.$store.state.user.username),1),(0,o._)("ul",k,[(0,o._)("li",null,[(0,o.Wm)(z,{class:"dropdown-item",to:{name:"user_bot_index"}},{default:(0,o.w5)((()=>[w])),_:1})]),x,(0,o._)("li",null,[(0,o._)("a",{class:"dropdown-item",href:"#",onClick:e[0]||(e[0]=(...t)=>a.logout&&a.logout(...t))},"退出")])])])])):t.$store.state.user.pulling_info?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("ul",C,[(0,o._)("li",I,[(0,o.Wm)(z,{class:"nav-link",to:{name:"user_account_login"},role:"button"},{default:(0,o.w5)((()=>[j])),_:1})]),(0,o._)("li",D,[(0,o.Wm)(z,{class:"nav-link",to:{name:"user_account_register"},role:"button"},{default:(0,o.w5)((()=>[A])),_:1})])]))])])])}var z=s(2483),S=s(65),M={setup(){const t=(0,S.oR)(),e=(0,z.yj)();let s=(0,o.Fl)((()=>e.name));const a=()=>{t.dispatch("logout")};return{route_name:s,logout:a}}},U=s(89);const B=(0,U.Z)(M,[["render",O]]);var H=B,P=s(5654),$={components:{NavBar:H},setup(){}};const R=(0,U.Z)($,[["render",n]]);var q=R;function L(t,e,s,a,n,r){const l=(0,o.up)("PlayGround"),i=(0,o.up)("MatchGround"),c=(0,o.up)("ResultBoard");return(0,o.wg)(),(0,o.iD)(o.HY,null,["playing"===t.$store.state.pk.status?((0,o.wg)(),(0,o.j4)(l,{key:0})):(0,o.kq)("",!0),"matching"===t.$store.state.pk.status?((0,o.wg)(),(0,o.j4)(i,{key:1})):(0,o.kq)("",!0),"none"!=t.$store.state.pk.loser?((0,o.wg)(),(0,o.j4)(c,{key:2})):(0,o.kq)("",!0)],64)}const F={class:"playground"};function W(t,e,s,a,n,r){const l=(0,o.up)("GameMap");return(0,o.wg)(),(0,o.iD)("div",F,[(0,o.Wm)(l)])}const Z={ref:"parent",class:"gamemap"},V={ref:"canvas",tabindex:"0"};function G(t,e,s,a,n,r){return(0,o.wg)(),(0,o.iD)("div",Z,[(0,o._)("canvas",V,null,512)],512)}const T=[];class N{constructor(){T.push(this),this.timedelta=0,this.has_called_start=!1}start(){}update(){}on_destroy(){}destroy(){this.on_destroy();for(let t in T){const e=T[t];if(e===this){T.splice(t);break}}}}let Y;const E=t=>{for(let e of T)e.has_called_start?(e.timedelta=t-Y,e.update()):(e.has_called_start=!0,e.start());Y=t,requestAnimationFrame(E)};requestAnimationFrame(E);class K extends N{constructor(t,e,s){super(),this.r=t,this.c=e,this.gamemap=s,this.color="#B37226"}update(){this.render()}render(){const t=this.gamemap.L,e=this.gamemap.ctx;e.fillStyle=this.color,e.fillRect(this.c*t,this.r*t,t,t)}}class J{constructor(t,e){this.r=t,this.c=e,this.x=e+.5,this.y=t+.5}}class Q extends N{constructor(t,e){super(),this.id=t.id,this.color=t.color,this.gamemap=e,this.cells=[new J(t.r,t.c)],this.next_cell=null,this.speed=5,this.direction=-1,this.status="idle",this.dr=[-1,0,1,0],this.dc=[0,1,0,-1],this.step=0,this.eps=.01,this.eye_direction=0,1===this.id&&(this.eye_direction=2),this.eye_dx=[[-1,1],[1,1],[1,-1],[-1,-1]],this.eye_dy=[[-1,-1],[-1,1],[1,1],[1,-1]]}start(){}set_direction(t){this.direction=t}check_tail_increasing(){return this.step<=10||this.step%3===1}next_step(){const t=this.direction;this.next_cell=new J(this.cells[0].r+this.dr[t],this.cells[0].c+this.dc[t]),this.eye_direction=t,this.direction=-1,this.status="move",this.step++;const e=this.cells.length;for(let s=e;s>0;s--)this.cells[s]=JSON.parse(JSON.stringify(this.cells[s-1]))}update_move(){const t=this.next_cell.x-this.cells[0].x,e=this.next_cell.y-this.cells[0].y,s=Math.sqrt(t*t+e*e);if(s<this.eps)this.cells[0]=this.next_cell,this.next_cell=null,this.status="idle",this.check_tail_increasing()||this.cells.pop();else{const a=this.speed*this.timedelta/1e3;if(this.cells[0].x+=a*t/s,this.cells[0].y+=a*e/s,!this.check_tail_increasing()){const t=this.cells.length,e=this.cells[t-1],o=this.cells[t-2],n=o.x-e.x,r=o.y-e.y;e.x+=a*n/s,e.y+=a*r/s}}}update(){"move"===this.status&&this.update_move(),this.render()}render(){const t=this.gamemap.L,e=this.gamemap.ctx;e.fillStyle=this.color,"die"===this.status&&(e.fillStyle="white");for(const s of this.cells)e.beginPath(),e.arc(s.x*t,s.y*t,t/2*.8,0,2*Math.PI),e.fill();for(let s=1;s<this.cells.length;s++){const a=this.cells[s-1],o=this.cells[s];Math.abs(a.x-o.x)<this.eps&&Math.abs(a.y-o.y)<this.eps||(Math.abs(a.x-o.x)<this.eps?e.fillRect((a.x-.4)*t,Math.min(a.y,o.y)*t,.8*t,Math.abs(a.y-o.y)*t):e.fillRect(Math.min(a.x,o.x)*t,(a.y-.4)*t,Math.abs(a.x-o.x)*t,.8*t))}e.fillStyle="black";for(let s=0;s<2;s++){const a=(this.cells[0].x+.15*this.eye_dx[this.eye_direction][s])*t,o=(this.cells[0].y+.15*this.eye_dy[this.eye_direction][s])*t;e.beginPath(),e.arc(a,o,.05*t,0,2*Math.PI),e.fill()}}}class X extends N{constructor(t,e,s){super(),this.ctx=t,this.parent=e,this.store=s,this.L=0,this.rows=13,this.cols=14,this.inner_walls_count=20,this.walls=[],this.snakes=[new Q({id:0,color:"#4876EC",r:this.rows-2,c:1},this),new Q({id:1,color:"#F94848",r:1,c:this.cols-2},this)]}create_walls(){const t=this.store.state.pk.gamemap;for(let e=0;e<this.rows;e++)for(let s=0;s<this.cols;s++)t[e][s]&&this.walls.push(new K(e,s,this))}add_listening_events(){if(console.log(this.store.state.record),this.store.state.record.is_record){let t=0;const e=this.store.state.record.a_steps,s=this.store.state.record.b_steps,a=this.store.state.record.record_loser,[o,n]=this.snakes,r=setInterval((()=>{t>=e.length-1?("all"!==a&&"A"!==a||(o.status="die"),"all"!==a&&"B"!==a||(n.status="die"),clearInterval(r)):(o.set_direction(parseInt(e[t])),n.set_direction(parseInt(s[t]))),t++}),300)}else this.ctx.canvas.focus(),this.ctx.canvas.addEventListener("keydown",(t=>{let e=-1;"w"===t.key?e=0:"d"===t.key?e=1:"s"===t.key?e=2:"a"===t.key&&(e=3),e>=0&&this.store.state.pk.socket.send(JSON.stringify({event:"move",direction:e}))}))}start(){this.create_walls(),this.add_listening_events()}update_size(){this.L=parseInt(Math.min(this.parent.clientWidth/this.cols,this.parent.clientHeight/this.rows)),this.ctx.canvas.width=this.L*this.cols,this.ctx.canvas.height=this.L*this.rows}check_ready(){for(const t of this.snakes){if("idle"!==t.status)return!1;if(-1===t.direction)return!1}return!0}next_step(){for(const t of this.snakes)t.next_step()}check_valid(t){for(const e of this.walls)if(e.r===t.r&&e.c===t.c)return!1;for(const e of this.snakes){let s=e.cells.length;e.check_tail_increasing()||s--;for(let a=0;a<s;a++)if(e.cells[a].r===t.r&&e.cells[a].c===t.c)return!1}return!0}update(){this.update_size(),this.check_ready()&&this.next_step(),this.render()}render(){const t="#AAD751",e="#A2D149";for(let s=0;s<this.rows;s++)for(let a=0;a<this.cols;a++)this.ctx.fillStyle=(s+a)%2==0?t:e,this.ctx.fillRect(a*this.L,s*this.L,this.L,this.L)}}var tt=s(4870),et={setup(){const t=(0,S.oR)();let e=(0,tt.iH)(null),s=(0,tt.iH)(null);return(0,o.bv)((()=>{t.commit("updateGameObject",new X(s.value.getContext("2d"),e.value,t))})),{parent:e,canvas:s}}};const st=(0,U.Z)(et,[["render",G],["__scopeId","data-v-0ae5d7f6"]]);var at=st,ot={components:{GameMap:at}};const nt=(0,U.Z)(ot,[["render",W],["__scopeId","data-v-656d9b26"]]);var rt=nt;const lt=t=>((0,o.dD)("data-v-a91ff694"),t=t(),(0,o.Cn)(),t),it={class:"matchground"},ct={class:"row"},dt={class:"col-4"},ut={class:"user-photo"},pt=["src"],_t={class:"user-username"},mt={class:"col-4"},ht={class:"user-select-bot"},bt=lt((()=>(0,o._)("option",{value:"-1",selected:""},"亲自出马",-1))),gt=["value"],vt={class:"col-4"},ft={class:"user-photo"},yt=["src"],kt={class:"user-username"},wt={class:"col-12",style:{"text-align":"center","padding-top":"15vh"}};function xt(t,e,s,n,l,i){return(0,o.wg)(),(0,o.iD)("div",it,[(0,o._)("div",ct,[(0,o._)("div",dt,[(0,o._)("div",ut,[(0,o._)("img",{src:t.$store.state.user.photo,alt:""},null,8,pt)]),(0,o._)("div",_t,(0,r.zw)(t.$store.state.user.username),1)]),(0,o._)("div",mt,[(0,o._)("div",ht,[(0,o.wy)((0,o._)("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>n.select_bot=t),class:"form-select","aria-label":"Default select example"},[bt,((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.bots,(t=>((0,o.wg)(),(0,o.iD)("option",{key:t.id,value:t.id},(0,r.zw)(t.title),9,gt)))),128))],512),[[a.bM,n.select_bot]])])]),(0,o._)("div",vt,[(0,o._)("div",ft,[(0,o._)("img",{src:t.$store.state.pk.opponent_photo,alt:""},null,8,yt)]),(0,o._)("div",kt,(0,r.zw)(t.$store.state.pk.opponent_username),1)]),(0,o._)("div",wt,[(0,o._)("button",{onClick:e[1]||(e[1]=(...t)=>n.click_match_btn&&n.click_match_btn(...t)),type:"button",class:"btn btn-warning btn-lg"},(0,r.zw)(n.match_btn_info),1)])])])}var Ct=s(7387),It=s.n(Ct),jt={setup(){const t=(0,S.oR)();let e=(0,tt.iH)("开始匹配"),s=(0,tt.iH)([]),a=(0,tt.iH)("-1");const o=()=>{"开始匹配"===e.value?(e.value="取消",t.state.pk.socket.send(JSON.stringify({event:"start-matching",bot_id:a.value}))):(e.value="开始匹配",t.state.pk.socket.send(JSON.stringify({event:"stop-matching"})))},n=()=>{It().ajax({url:"http://localhost:3000/api/user/bot/getlist/",type:"get",headers:{Authorization:"Bearer "+t.state.user.token},success(t){s.value=t}})};return n(),{match_btn_info:e,click_match_btn:o,bots:s,select_bot:a}}};const Dt=(0,U.Z)(jt,[["render",xt],["__scopeId","data-v-a91ff694"]]);var At=Dt;const Ot={class:"result-board"},zt={key:0,class:"result-board-text"},St={key:1,class:"result-board-text"},Mt={key:2,class:"result-board-text"},Ut={key:3,class:"result-board-text"},Bt={class:"result-board-btn"};function Ht(t,e,s,a,n,r){return(0,o.wg)(),(0,o.iD)("div",Ot,["all"===t.$store.state.pk.loser?((0,o.wg)(),(0,o.iD)("div",zt," Draw ")):"A"===t.$store.state.pk.loser&&t.$store.state.pk.a_id===parseInt(t.$store.state.user.id)?((0,o.wg)(),(0,o.iD)("div",St," Lose ")):"B"===t.$store.state.pk.loser&&t.$store.state.pk.b_id===parseInt(t.$store.state.user.id)?((0,o.wg)(),(0,o.iD)("div",Mt," Lose ")):((0,o.wg)(),(0,o.iD)("div",Ut," Win ")),(0,o._)("div",Bt,[(0,o._)("button",{onClick:e[0]||(e[0]=(...t)=>a.restart&&a.restart(...t)),type:"button",class:"btn btn-warning btn-lg"}," 再来! ")])])}var Pt={setup(){const t=(0,S.oR)(),e=()=>{t.commit("updateStatus","matching"),t.commit("updateLoser","none"),t.commit("updateOpponent",{username:"我的对手",photo:"https://cdn.acwing.com/media/article/image/2022/08/09/1_1db2488f17-anonymous.png"})};return{restart:e}}};const $t=(0,U.Z)(Pt,[["render",Ht],["__scopeId","data-v-34e201d5"]]);var Rt=$t,qt={components:{PlayGround:rt,MatchGround:At,ResultBoard:Rt},setup(){const t=(0,S.oR)(),e=`ws://localhost:3000/websocket/${t.state.user.token}/`;t.commit("updateLoser","none"),t.commit("updateIsRecord",!1);let s=null;(0,o.bv)((()=>{t.commit("updateOpponent",{username:"我的对手",photo:"https://cdn.acwing.com/media/article/image/2022/08/09/1_1db2488f17-anonymous.png"}),s=new WebSocket(e),s.onopen=()=>{console.log("connected!"),t.commit("updateSocket",s)},s.onmessage=e=>{const s=JSON.parse(e.data);if("start-matching"===s.event)t.commit("updateOpponent",{username:s.opponent_username,photo:s.opponent_photo}),setTimeout((()=>{t.commit("updateStatus","playing")}),200),t.commit("updateGame",s.game);else if("move"===s.event){console.log(s);const e=t.state.pk.gameObject,[a,o]=e.snakes;a.set_direction(s.a_direction),o.set_direction(s.b_direction)}else if("result"===s.event){console.log(s);const e=t.state.pk.gameObject,[a,o]=e.snakes;"all"!==s.loser&&"A"!==s.loser||(a.status="die"),"all"!==s.loser&&"B"!==s.loser||(o.status="die"),t.commit("updateLoser",s.loser)}},s.onclose=()=>{console.log("disconnected!")}})),(0,o.Ah)((()=>{s.close(),t.commit("updateStatus","matching")}))}};const Lt=(0,U.Z)(qt,[["render",L]]);var Ft=Lt;const Wt=t=>((0,o.dD)("data-v-d02ca320"),t=t(),(0,o.Cn)(),t),Zt={class:"table table-striped table-hover",style:{"text-align":"center"}},Vt=Wt((()=>(0,o._)("thead",null,[(0,o._)("tr",null,[(0,o._)("th",null,"A"),(0,o._)("th",null,"B"),(0,o._)("th",null,"对战结果"),(0,o._)("th",null,"对战时间"),(0,o._)("th",null,"操作")])],-1))),Gt=["src"],Tt=(0,o.Uk)("   "),Nt={class:"record-user-username"},Yt=["src"],Et=(0,o.Uk)("   "),Kt={class:"record-user-username"},Jt=["onClick"],Qt={"aria-label":"..."},Xt={class:"pagination",style:{float:"right"}},te=Wt((()=>(0,o._)("a",{class:"page-link",href:"#"},"前一页",-1))),ee=[te],se=["onClick"],ae={class:"page-link",href:"#"},oe=Wt((()=>(0,o._)("a",{class:"page-link",href:"#"},"后一页",-1))),ne=[oe];function re(t,e,s,a,n,l){const i=(0,o.up)("ContentField");return(0,o.wg)(),(0,o.j4)(i,null,{default:(0,o.w5)((()=>[(0,o._)("table",Zt,[Vt,(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(a.records,(t=>((0,o.wg)(),(0,o.iD)("tr",{key:t.record.id},[(0,o._)("td",null,[(0,o._)("img",{src:t.a_photo,alt:"",class:"record-user-photo"},null,8,Gt),Tt,(0,o._)("span",Nt,(0,r.zw)(t.a_username),1)]),(0,o._)("td",null,[(0,o._)("img",{src:t.b_photo,alt:"",class:"record-user-photo"},null,8,Yt),Et,(0,o._)("span",Kt,(0,r.zw)(t.b_username),1)]),(0,o._)("td",null,(0,r.zw)(t.result),1),(0,o._)("td",null,(0,r.zw)(t.record.createtime),1),(0,o._)("td",null,[(0,o._)("button",{onClick:e=>a.open_record_content(t.record.id),type:"button",class:"btn btn-secondary"},"查看录像",8,Jt)])])))),128))])]),(0,o._)("nav",Qt,[(0,o._)("ul",Xt,[(0,o._)("li",{class:"page-item",onClick:e[0]||(e[0]=t=>a.click_page(-2))},ee),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(a.pages,(t=>((0,o.wg)(),(0,o.iD)("li",{class:(0,r.C_)("page-item "+t.is_active),key:t.number,onClick:e=>a.click_page(t.number)},[(0,o._)("a",ae,(0,r.zw)(t.number),1)],10,se)))),128)),(0,o._)("li",{class:"page-item",onClick:e[1]||(e[1]=t=>a.click_page(-1))},ne)])])])),_:1})}const le={class:"container content-field"},ie={class:"card"},ce={class:"card-body"};function de(t,e){return(0,o.wg)(),(0,o.iD)("div",le,[(0,o._)("div",ie,[(0,o._)("div",ce,[(0,o.WI)(t.$slots,"default",{},void 0,!0)])])])}const ue={},pe=(0,U.Z)(ue,[["render",de],["__scopeId","data-v-01b1c26b"]]);var _e=pe,me={components:{ContentField:_e},setup(){const t=(0,S.oR)();let e=(0,tt.iH)([]),s=1,a=0,o=(0,tt.iH)([]);const n=t=>{-2===t?t=s-1:-1===t&&(t=s+1);let e=parseInt(Math.ceil(a/10));t>=1&&t<=e&&l(t)},r=()=>{let t=parseInt(Math.ceil(a/10)),e=[];for(let a=s-2;a<=s+2;a++)a>=1&&a<=t&&e.push({number:a,is_active:a===s?"active":""});o.value=e},l=o=>{s=o,It().ajax({url:"http://localhost:3000/api/record/getlist/",data:{page:o},type:"get",headers:{Authorization:"Bearer "+t.state.user.token},success(t){e.value=t.records,a=t.records_count,r()},error(t){console.log(t)}})};l(s);const i=t=>{let e=[];for(let s=0,a=0;s<13;s++){let s=[];for(let e=0;e<14;e++,a++)"0"===t[a]?s.push(0):s.push(1);e.push(s)}return e},c=s=>{for(const a of e.value)if(a.record.id===s){t.commit("updateIsRecord",!0),t.commit("updateGame",{map:i(a.record.map),a_id:a.record.aid,a_sx:a.record.asx,a_sy:a.record.asy,b_id:a.record.bid,b_sx:a.record.bsx,b_sy:a.record.bsy}),t.commit("updateSteps",{a_steps:a.record.asteps,b_steps:a.record.bsteps}),t.commit("updateRecordLoser",a.record.loser),Ia.push({name:"record_content",params:{recordId:s}});break}};return{records:e,open_record_content:c,pages:o,click_page:n}}};const he=(0,U.Z)(me,[["render",re],["__scopeId","data-v-d02ca320"]]);var be=he;function ge(t,e,s,a,n,r){const l=(0,o.up)("PlayGround");return(0,o.wg)(),(0,o.j4)(l)}var ve={components:{PlayGround:rt},setup(){}};const fe=(0,U.Z)(ve,[["render",ge]]);var ye=fe;const ke=t=>((0,o.dD)("data-v-26f8146c"),t=t(),(0,o.Cn)(),t),we={class:"table table-striped table-hover",style:{"text-align":"center"}},xe=ke((()=>(0,o._)("thead",null,[(0,o._)("tr",null,[(0,o._)("th",null,"玩家"),(0,o._)("th",null,"天梯分")])],-1))),Ce=["src"],Ie=(0,o.Uk)("   "),je={class:"record-user-username"},De={"aria-label":"..."},Ae={class:"pagination",style:{float:"right"}},Oe=ke((()=>(0,o._)("a",{class:"page-link",href:"#"},"前一页",-1))),ze=[Oe],Se=["onClick"],Me={class:"page-link",href:"#"},Ue=ke((()=>(0,o._)("a",{class:"page-link",href:"#"},"后一页",-1))),Be=[Ue];function He(t,e,s,a,n,l){const i=(0,o.up)("ContentField");return(0,o.wg)(),(0,o.j4)(i,null,{default:(0,o.w5)((()=>[(0,o._)("table",we,[xe,(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(a.users,(t=>((0,o.wg)(),(0,o.iD)("tr",{key:t.id},[(0,o._)("td",null,[(0,o._)("img",{src:t.photo,alt:"",class:"record-user-photo"},null,8,Ce),Ie,(0,o._)("span",je,(0,r.zw)(t.username),1)]),(0,o._)("td",null,(0,r.zw)(t.rating),1)])))),128))])]),(0,o._)("nav",De,[(0,o._)("ul",Ae,[(0,o._)("li",{class:"page-item",onClick:e[0]||(e[0]=t=>a.click_page(-2))},ze),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(a.pages,(t=>((0,o.wg)(),(0,o.iD)("li",{class:(0,r.C_)("page-item "+t.is_active),key:t.number,onClick:e=>a.click_page(t.number)},[(0,o._)("a",Me,(0,r.zw)(t.number),1)],10,Se)))),128)),(0,o._)("li",{class:"page-item",onClick:e[1]||(e[1]=t=>a.click_page(-1))},Be)])])])),_:1})}var Pe={components:{ContentField:_e},setup(){const t=(0,S.oR)();let e=(0,tt.iH)([]),s=1,a=0,o=(0,tt.iH)([]);const n=t=>{-2===t?t=s-1:-1===t&&(t=s+1);let e=parseInt(Math.ceil(a/3));t>=1&&t<=e&&l(t)},r=()=>{let t=parseInt(Math.ceil(a/3)),e=[];for(let a=s-2;a<=s+2;a++)a>=1&&a<=t&&e.push({number:a,is_active:a===s?"active":""});o.value=e},l=o=>{s=o,It().ajax({url:"http://localhost:3000/api/ranklist/getlist/",data:{page:o},type:"get",headers:{Authorization:"Bearer "+t.state.user.token},success(t){e.value=t.users,console.log(e.value),a=t.users_count,r()},error(t){console.log(t)}})};return l(s),{users:e,pages:o,click_page:n}}};const $e=(0,U.Z)(Pe,[["render",He],["__scopeId","data-v-26f8146c"]]);var Re=$e;const qe=t=>((0,o.dD)("data-v-19f79075"),t=t(),(0,o.Cn)(),t),Le={class:"container"},Fe={class:"row"},We={class:"col-3"},Ze={class:"card",style:{"margin-top":"20px"}},Ve={class:"card-body"},Ge=["src"],Te={class:"col-9"},Ne={class:"card",style:{"margin-top":"20px"}},Ye={class:"card-header"},Ee=qe((()=>(0,o._)("span",{style:{"font-size":"130%"}},"我的Bot",-1))),Ke=qe((()=>(0,o._)("button",{type:"button",class:"btn btn-primary float-end","data-bs-toggle":"modal","data-bs-target":"#add-bot-btn"}," 创建Bot ",-1))),Je={class:"modal fade",id:"add-bot-btn",tabindex:"-1"},Qe={class:"modal-dialog modal-xl"},Xe={class:"modal-content"},ts=qe((()=>(0,o._)("div",{class:"modal-header"},[(0,o._)("h5",{class:"modal-title"},"创建Bot"),(0,o._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1))),es={class:"modal-body"},ss={class:"mb-3"},as=qe((()=>(0,o._)("label",{for:"add-bot-title",class:"form-label"},"名称",-1))),os={class:"mb-3"},ns=qe((()=>(0,o._)("label",{for:"add-bot-description",class:"form-label"},"简介",-1))),rs={class:"mb-3"},ls=qe((()=>(0,o._)("label",{for:"add-bot-code",class:"form-label"},"代码",-1))),is={class:"modal-footer"},cs={class:"error-message"},ds=qe((()=>(0,o._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1))),us={class:"card-body"},ps={class:"table table-striped table-hover"},_s=qe((()=>(0,o._)("thead",null,[(0,o._)("tr",null,[(0,o._)("th",null,"名称"),(0,o._)("th",null,"创建时间"),(0,o._)("th",null,"操作")])],-1))),ms=["data-bs-target"],hs=["onClick"],bs=["id"],gs={class:"modal-dialog modal-xl"},vs={class:"modal-content"},fs=qe((()=>(0,o._)("div",{class:"modal-header"},[(0,o._)("h5",{class:"modal-title"},"创建Bot"),(0,o._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1))),ys={class:"modal-body"},ks={class:"mb-3"},ws=qe((()=>(0,o._)("label",{for:"add-bot-title",class:"form-label"},"名称",-1))),xs=["onUpdate:modelValue"],Cs={class:"mb-3"},Is=qe((()=>(0,o._)("label",{for:"add-bot-description",class:"form-label"},"简介",-1))),js=["onUpdate:modelValue"],Ds={class:"mb-3"},As=qe((()=>(0,o._)("label",{for:"add-bot-code",class:"form-label"},"代码",-1))),Os={class:"modal-footer"},zs={class:"error-message"},Ss=["onClick"],Ms=qe((()=>(0,o._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1)));function Us(t,e,s,n,l,i){const c=(0,o.up)("VAceEditor");return(0,o.wg)(),(0,o.iD)("div",Le,[(0,o._)("div",Fe,[(0,o._)("div",We,[(0,o._)("div",Ze,[(0,o._)("div",Ve,[(0,o._)("img",{src:t.$store.state.user.photo,alt:"",style:{width:"100%"}},null,8,Ge)])])]),(0,o._)("div",Te,[(0,o._)("div",Ne,[(0,o._)("div",Ye,[Ee,Ke,(0,o._)("div",Je,[(0,o._)("div",Qe,[(0,o._)("div",Xe,[ts,(0,o._)("div",es,[(0,o._)("div",ss,[as,(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>n.botadd.title=t),type:"text",class:"form-control",id:"add-bot-title",placeholder:"请输入Bot名称"},null,512),[[a.nr,n.botadd.title]])]),(0,o._)("div",os,[ns,(0,o.wy)((0,o._)("textarea",{"onUpdate:modelValue":e[1]||(e[1]=t=>n.botadd.description=t),class:"form-control",id:"add-bot-description",rows:"3",placeholder:"请输入Bot简介"},null,512),[[a.nr,n.botadd.description]])]),(0,o._)("div",rs,[ls,(0,o.Wm)(c,{value:n.botadd.content,"onUpdate:value":e[2]||(e[2]=t=>n.botadd.content=t),onInit:t.editorInit,lang:"c_cpp",theme:"textmate",style:{height:"300px"}},null,8,["value","onInit"])])]),(0,o._)("div",is,[(0,o._)("div",cs,(0,r.zw)(n.botadd.error_message),1),(0,o._)("button",{type:"button",class:"btn btn-primary",onClick:e[3]||(e[3]=(...t)=>n.add_bot&&n.add_bot(...t))},"创建"),ds])])])])]),(0,o._)("div",us,[(0,o._)("table",ps,[_s,(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.bots,(e=>((0,o.wg)(),(0,o.iD)("tr",{key:e.id},[(0,o._)("td",null,(0,r.zw)(e.title),1),(0,o._)("td",null,(0,r.zw)(e.createtime),1),(0,o._)("td",null,[(0,o._)("button",{type:"button",class:"btn btn-secondary",style:{"margin-right":"10px"},"data-bs-toggle":"modal","data-bs-target":"#update-bot-modal-"+e.id},"修改",8,ms),(0,o._)("button",{type:"button",class:"btn btn-danger",onClick:t=>n.remove_bot(e)},"删除",8,hs),(0,o._)("div",{class:"modal fade",id:"update-bot-modal-"+e.id,tabindex:"-1"},[(0,o._)("div",gs,[(0,o._)("div",vs,[fs,(0,o._)("div",ys,[(0,o._)("div",ks,[ws,(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":t=>e.title=t,type:"text",class:"form-control",id:"add-bot-title",placeholder:"请输入Bot名称"},null,8,xs),[[a.nr,e.title]])]),(0,o._)("div",Cs,[Is,(0,o.wy)((0,o._)("textarea",{"onUpdate:modelValue":t=>e.description=t,class:"form-control",id:"add-bot-description",rows:"3",placeholder:"请输入Bot简介"},null,8,js),[[a.nr,e.description]])]),(0,o._)("div",Ds,[As,(0,o.Wm)(c,{value:e.content,"onUpdate:value":t=>e.content=t,onInit:t.editorInit,lang:"c_cpp",theme:"textmate",style:{height:"300px"}},null,8,["value","onUpdate:value","onInit"])])]),(0,o._)("div",Os,[(0,o._)("div",zs,(0,r.zw)(e.error_message),1),(0,o._)("button",{type:"button",class:"btn btn-primary",onClick:t=>n.update_bot(e)},"保存修改",8,Ss),Ms])])])],8,bs)])])))),128))])])])])])])])}var Bs=s(6092),Hs=s(17),Ps=s.n(Hs),$s={components:{VAceEditor:Bs.m},setup(){Ps().config.set("basePath","https://cdn.jsdelivr.net/npm/ace-builds@"+s(17).version+"/src-noconflict/");const t=(0,S.oR)();let e=(0,tt.iH)([]);const a=(0,tt.qj)({title:"",description:"",content:"",error_message:""}),o=()=>{It().ajax({url:"http://localhost:3000/api/user/bot/getlist/",type:"get",headers:{Authorization:"Bearer "+t.state.user.token},success(t){e.value=t}})};o();const n=()=>{a.error_message="",It().ajax({url:"http://localhost:3000/api/user/bot/add/",type:"post",data:{title:a.title,description:a.description,content:a.content},headers:{Authorization:"Bearer "+t.state.user.token},success(t){"success"===t.error_message?(a.title="",a.description="",a.content="",P.Modal.getInstance("#add-bot-btn").hide(),o()):a.error_message=t.error_message}})},r=e=>{a.error_message="",It().ajax({url:"http://localhost:3000/api/user/bot/update/",type:"post",data:{bot_id:e.id,title:e.title,description:e.description,content:e.content},headers:{Authorization:"Bearer "+t.state.user.token},success(t){"success"===t.error_message?(P.Modal.getInstance("#update-bot-modal-"+e.id).hide(),o()):a.error_message=t.error_message}})},l=e=>{It().ajax({url:"http://localhost:3000/api/user/bot/remove/",type:"post",data:{bot_id:e.id},headers:{Authorization:"Bearer "+t.state.user.token},success(t){"success"===t.error_message&&o()}})};return{bots:e,botadd:a,add_bot:n,update_bot:r,remove_bot:l}}};const Rs=(0,U.Z)($s,[["render",Us],["__scopeId","data-v-19f79075"]]);var qs=Rs;const Ls=(0,o.Uk)(" 404 Not Found ");function Fs(t,e,s,a,n,r){const l=(0,o.up)("ContentField");return(0,o.wg)(),(0,o.j4)(l,null,{default:(0,o.w5)((()=>[Ls])),_:1})}var Ws={components:{ContentField:_e}};const Zs=(0,U.Z)(Ws,[["render",Fs]]);var Vs=Zs;const Gs=t=>((0,o.dD)("data-v-94bc6d70"),t=t(),(0,o.Cn)(),t),Ts={class:"row justify-content-md-center"},Ns={class:"col-3"},Ys={class:"mb-3"},Es=Gs((()=>(0,o._)("label",{for:"username",class:"form-label"},"用户名",-1))),Ks={class:"mb-3"},Js=Gs((()=>(0,o._)("label",{for:"password",class:"form-label"},"密码",-1))),Qs={class:"error-message"},Xs=Gs((()=>(0,o._)("button",{type:"submit",class:"btn btn-primary"},"提交",-1)));function ta(t,e,s,n,l,i){const c=(0,o.up)("ContentField");return t.$store.state.user.pulling_info?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(c,{key:0},{default:(0,o.w5)((()=>[(0,o._)("div",Ts,[(0,o._)("div",Ns,[(0,o._)("form",{onSubmit:e[2]||(e[2]=(0,a.iM)(((...t)=>n.login&&n.login(...t)),["prevent"]))},[(0,o._)("div",Ys,[Es,(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>n.username=t),type:"text",class:"form-control",id:"username",placeholder:"请输入用户名"},null,512),[[a.nr,n.username]])]),(0,o._)("div",Ks,[Js,(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>n.password=t),type:"password",class:"form-control",id:"password",placeholder:"请输入密码"},null,512),[[a.nr,n.password]])]),(0,o._)("div",Qs,(0,r.zw)(n.error_message),1),Xs],32)])])])),_:1}))}var ea={components:{ContentField:_e},setup(){const t=(0,S.oR)();let e=(0,tt.iH)(""),s=(0,tt.iH)(""),a=(0,tt.iH)("");const o=localStorage.getItem("jwt_token");o?(t.commit("updateToken",o),t.dispatch("getinfo",{success(){Ia.push({name:"home"}),t.commit("updatePullingInfo",!1)},error(){t.commit("updatePullingInfo",!1)}})):t.commit("updatePullingInfo",!1);const n=()=>{a.value="",t.dispatch("login",{username:e.value,password:s.value,success(){t.dispatch("getinfo",{success(){Ia.push({name:"home"})}})},error(){a.value="用户名或密码错误"}})};return{username:e,password:s,error_message:a,login:n}}};const sa=(0,U.Z)(ea,[["render",ta],["__scopeId","data-v-94bc6d70"]]);var aa=sa;const oa=t=>((0,o.dD)("data-v-a6eadb38"),t=t(),(0,o.Cn)(),t),na={class:"row justify-content-md-center"},ra={class:"col-3"},la={class:"mb-3"},ia=oa((()=>(0,o._)("label",{for:"username",class:"form-label"},"用户名",-1))),ca={class:"mb-3"},da=oa((()=>(0,o._)("label",{for:"password",class:"form-label"},"密码",-1))),ua={class:"mb-3"},pa=oa((()=>(0,o._)("label",{for:"confirmedPassword",class:"form-label"},"确认密码",-1))),_a={class:"error-message"},ma=oa((()=>(0,o._)("button",{type:"submit",class:"btn btn-primary"},"提交",-1)));function ha(t,e,s,n,l,i){const c=(0,o.up)("ContentField");return(0,o.wg)(),(0,o.j4)(c,null,{default:(0,o.w5)((()=>[(0,o._)("div",na,[(0,o._)("div",ra,[(0,o._)("form",{onSubmit:e[3]||(e[3]=(0,a.iM)(((...t)=>n.register&&n.register(...t)),["prevent"]))},[(0,o._)("div",la,[ia,(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>n.username=t),type:"text",class:"form-control",id:"username",placeholder:"请输入用户名"},null,512),[[a.nr,n.username]])]),(0,o._)("div",ca,[da,(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>n.password=t),type:"password",class:"form-control",id:"password",placeholder:"请输入密码"},null,512),[[a.nr,n.password]])]),(0,o._)("div",ua,[pa,(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>n.confirmedPassword=t),type:"password",class:"form-control",id:"confirmedPassword",placeholder:"请再次输入密码"},null,512),[[a.nr,n.confirmedPassword]])]),(0,o._)("div",_a,(0,r.zw)(n.error_message),1),ma],32)])])])),_:1})}var ba={components:{ContentField:_e},setup(){let t=(0,tt.iH)(""),e=(0,tt.iH)(""),s=(0,tt.iH)(""),a=(0,tt.iH)("");const o=()=>{It().ajax({url:"http://localhost:3000/api/user/account/register/",type:"post",data:{username:t.value,password:e.value,confirmedPassword:s.value},success(t){"success"===t.error_message?Ia.push({name:"user_account_login"}):a.value=t.error_message}})};return{username:t,password:e,confirmedPassword:s,error_message:a,register:o}}};const ga=(0,U.Z)(ba,[["render",ha],["__scopeId","data-v-a6eadb38"]]);var va=ga,fa={state:{id:"",username:"",photo:"",token:"",is_login:!1,pulling_info:!0},getters:{},mutations:{updateUser(t,e){t.id=e.id,t.username=e.username,t.photo=e.photo,t.is_login=e.is_login},updateToken(t,e){t.token=e},logout(t){t.id="",t.username="",t.photo="",t.token="",t.is_login=!1},updatePullingInfo(t,e){t.pulling_info=e}},actions:{login(t,e){It().ajax({url:"http://localhost:3000/api/user/account/token/",type:"post",data:{username:e.username,password:e.password},success(s){"success"===s.error_message?(localStorage.setItem("jwt_token",s.token),t.commit("updateToken",s.token),e.success(s)):e.error(s)},error(t){e.error(t)}})},getinfo(t,e){It().ajax({url:"http://localhost:3000/api/user/account/info/",type:"get",headers:{Authorization:"Bearer "+t.state.token},success(s){"success"===s.error_message?(t.commit("updateUser",{...s,is_login:!0}),e.success(s)):e.error(s)},error(t){e.error(t)}})},logout(t){localStorage.removeItem("jwt_token"),t.commit("logout")}},modules:{}},ya={state:{status:"matching",socket:null,opponent_username:"",opponent_photo:"",gamemap:null,a_id:0,a_sx:0,a_sy:0,b_id:0,b_sx:0,b_sy:0,gameObject:null,loser:"none"},getters:{},mutations:{updateSocket(t,e){t.socket=e},updateOpponent(t,e){t.opponent_username=e.username,t.opponent_photo=e.photo},updateStatus(t,e){t.status=e},updateGame(t,e){t.gamemap=e.map,t.a_id=e.a_id,t.a_sx=e.a_sx,t.a_sy=e.a_sy,t.b_id=e.b_id,t.b_sx=e.b_sx,t.b_sy=e.b_sy},updateGameObject(t,e){t.gameObject=e},updateLoser(t,e){t.loser=e}},actions:{},modules:{}},ka={state:{is_record:!1,a_steps:"",b_steps:"",record_loser:""},getters:{},mutations:{updateIsRecord(t,e){t.is_record=e},updateSteps(t,e){t.a_steps=e.a_steps,t.b_steps=e.b_steps},updateRecordLoser(t,e){t.record_loser=e}},actions:{},modules:{}},wa=(0,S.MT)({state:{},getters:{},mutations:{},actions:{},modules:{user:fa,pk:ya,record:ka}});const xa=[{path:"/",name:"home",redirect:"/pk/",meta:{requestAuth:!0}},{path:"/pk/",name:"pk_index",component:Ft,meta:{requestAuth:!0}},{path:"/record/",name:"record_index",component:be,meta:{requestAuth:!0}},{path:"/record/:recordId/",name:"record_content",component:ye,meta:{requestAuth:!0}},{path:"/ranklist/",name:"ranklist_index",component:Re,meta:{requestAuth:!0}},{path:"/user/bot/",name:"user_bot_index",component:qs,meta:{requestAuth:!0}},{path:"/user/account/login/",name:"user_account_login",component:aa,meta:{requestAuth:!1}},{path:"/user/account/register/",name:"user_account_register",component:va,meta:{requestAuth:!1}},{path:"/404/",name:"404",component:Vs,meta:{requestAuth:!1}},{path:"/:catchAll(.*)",redirect:"/404/"}],Ca=(0,z.p7)({history:(0,z.PO)(),routes:xa});Ca.beforeEach(((t,e,s)=>{t.meta.requestAuth&&!wa.state.user.is_login?s({name:"user_account_login"}):s()}));var Ia=Ca;(0,a.ri)(q).use(wa).use(Ia).mount("#app")}},e={};function s(a){var o=e[a];if(void 0!==o)return o.exports;var n=e[a]={id:a,loaded:!1,exports:{}};return t[a].call(n.exports,n,n.exports,s),n.loaded=!0,n.exports}s.m=t,function(){s.amdD=function(){throw new Error("define cannot be used indirect")}}(),function(){var t=[];s.O=function(e,a,o,n){if(!a){var r=1/0;for(d=0;d<t.length;d++){a=t[d][0],o=t[d][1],n=t[d][2];for(var l=!0,i=0;i<a.length;i++)(!1&n||r>=n)&&Object.keys(s.O).every((function(t){return s.O[t](a[i])}))?a.splice(i--,1):(l=!1,n<r&&(r=n));if(l){t.splice(d--,1);var c=o();void 0!==c&&(e=c)}}return e}n=n||0;for(var d=t.length;d>0&&t[d-1][2]>n;d--)t[d]=t[d-1];t[d]=[a,o,n]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var a in e)s.o(e,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){s.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){var t={143:0};s.O.j=function(e){return 0===t[e]};var e=function(e,a){var o,n,r=a[0],l=a[1],i=a[2],c=0;if(r.some((function(e){return 0!==t[e]}))){for(o in l)s.o(l,o)&&(s.m[o]=l[o]);if(i)var d=i(s)}for(e&&e(a);c<r.length;c++)n=r[c],s.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return s.O(d)},a=self["webpackChunkweb"]=self["webpackChunkweb"]||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))}();var a=s.O(void 0,[998],(function(){return s(6479)}));a=s.O(a)})();
//# sourceMappingURL=app.d7e301ed.js.map